---
  - name: Loki - Write configuration
    template:
      src: loki/loki_yml.j2
      dest: "{{ docker.paths.configs }}loki/local-config.yaml"
      mode: 0644
      backup: yes
  - name: Loki - Change permissions for work dir
    file:
      path: "{{ docker.paths.work }}loki"
      mode: '0777'
  - name: Loki Plugin installed
    shell: docker plugin ls | grep loki | awk '{print $3}'
    register: loki_plugin
  - set_fact: 
      loki_plugin: "{{ loki_plugin.stdout }}"
  - debug: 
      var: loki_plugin
  - name: Install loki docker plugin
    command:
      cmd: docker plugin install grafana/loki-docker-driver:latest --alias loki --grant-all-permissions
    when: loki_plugin != "Loki"